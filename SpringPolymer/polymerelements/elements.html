<link rel="import" href="http://polygit.org/components/polymer/polymer.html" />

<!-- http://bstavroulakis.com/pluralsight/courses/polymer-js-getting-started/ -->
<dom-module id="hello-element">
	<template>Hello</template>
</dom-module>

<dom-module id="alert-element">
	<template>
		<input type="text" value="{{message::input}}" /><br>
		[[message]] [[message2]]
	</template>
</dom-module>

<dom-module id="object-data-binding">
	<template>
		<div>Text: {{message.text}}, Status: {{message.status}}</div>
	</template>
</dom-module>

<dom-module id="observer-demo">
	<template>
		Observer demo: <div hidden$="{{!loading}}">loading ({{loadingPercentage::value-changed}}%)...</div>
		[[message]] <input type="text" value="{{message::input}}"/><br>
	</template>
</dom-module>

<dom-module id="attribute-binding">
	<template>
		<input type="checkbox" checked$="{{messageChecked}}" />
		<div style$="{{messageStyle}}">
			<div class$="{{messageClass}}">
				<a href$="{{messageUrl}}">
					<label for$="{{messageLabel}}">Label</label>
					<div data-bar$="{{messageLabel}}">Data-bar</div>
				</a>
			</div>
		</div>
	</template>
</dom-module>

<dom-module id="computed-property">
	<template>
		<p>Computed property: {{message}}</p>
	</template>
</dom-module>

<dom-module id="conditional-template">
	<template>
		<!-- included only if the property is true -->
		<template is="dom-if" if="{{secureMessages}}">
			<p>SecureMessage: {{secureMessage}}</p>
		</template>
	</template>
</dom-module>

<dom-module id="template-repeater">
	<template>
		<!-- iterate through elements -->
		<template is="dom-repeat" items="{{messages}}">
			Index: {{index}}<br>
			Message: <b>{{item}}</b><br><br>
		</template>
		<template is="dom-repeat" items="{{priorityMsgs}}" as="priority">
			<p>{{priority.name}}<br>
			<template is="dom-repeat" items="{{priority.levels}}" as="level" index-as="level_index">
				{{level_index}} : {{level}}<br>
			</template></p>
		</template>
	</template>
</dom-module>

<dom-module id="dom-manipulate">
	<template>
		<p>
		<h2 id="alertHead"></h2>
		<ul>
			<li class="alert-message">Alert 1</li>
			<li class="alert-message">Alert 2</li>
			<li class="alert-message">Alert 3</li>
		</ul>
		</p>
	</template>
</dom-module>

<dom-module id="content-tag">
	<template>
		<p>
		<!-- select the first occurence of alert-head-content from the content-tag -->
		<h2 id="alertHead"><content select=".alert-head-content"></content></h2>
		<!-- content tag merges static content from element to template -->
		<content select=".alert-data"></content>
		<content></content>
		</p>
	</template>
</dom-module>
<script>

	var t = document.querySelector('#autoBind');
	t.data = ["AutoBind1", "AutoBind2"];
	
	HTMLImports.whenReady(function(){
		//element names must have hyphen
		Polymer({
			is: "hello-element"
		})
		
		Polymer({
			is: "content-tag"
		})
		
		Polymer({
			is: "dom-manipulate",
			ready: function(){
				
				// $ used to ref template data
				this.$.alertHead.textContent = 'Alerts Here';
				// $$ get first occurence
				console.log(this.$$(".alert-message"));
			}
		})
		
		Polymer({
			is: "template-repeater",
			properties: {
				messages: {
					type: Array,
					value: function(){
						return ["Message"+(new Date()).toString(), "Message"+(new Date()).toString(),
						        "Message"+(new Date()).toString(),"Message"+(new Date()).toString()];
					}
				},
				priorityMsgs: {
					type: Array,
					value: function(){
						return [{name: "Major", levels: ["Super major", "Kind of a major"]},
		                        {name: "Minor", levels: ["Minorish", "Good to have"]}
		                       ];
					}
				}
			}
		})
		
		Polymer({
			is: "conditional-template",
			properties: {
				secureMessage: {
					type: String,
					value: "I am secure message."
				},
				secureMessages: {
					type: Boolean,
					value: false
				}
			},
			ready: function(){
				var self = this;
				self.secureMessages = true;
				setTimeout(function(){
					self.secureMessages = false;
				}, 5000);
			}
		})
		
		Polymer({
			is: "observer-demo",
			properties:{
	          	loadingPercentage: {
	              type: Number,
	              value: 0
	            },
	            loading: {
	              type: Boolean,
	              value: true
	            },
	            message: {
	              type: String,
	              value: "hello",
	              observer: 'messageChanged'
	            },
	            loadStatus: {
	            	type: Object,
	            	value: function(){
	            		return {};
	            	}
	            }
			},
	        observers: [
              'loadingCheck(loadingPercentage, loading)',
              'checkAll(loadStatus.*)' //don't have to observe individual properties
            ],
            messageChanged: function(newValue, oldValue) {
              console.log(newValue +":" + oldValue);
            },
            checkAll: function(input){
            	console.log("checkAll "+input.value +":"+input.path+":"+input.base);
            },
            loadingCheck: function(loadingPercentange, loading) {
              console.log("loadingPercentage:", loadingPercentange, " loading:", loading);
            },
            ready: function(){
            	//this.loadingPercentage = this.loadingPercentage + 1; //does not trigger observers
            	//this.set("loadingPercentage", this.loadingPercentage + 1);
            	this.set("loadStatus.percent", 50);
            }
		})
		
		Polymer({
			is: "alert-element",
			properties: {
				message: {
					type: String,
					value: "data binding"
				}
			}
		})
		
		Polymer({
			is: "computed-property",
			properties: {
				loaded:{
					type: Boolean,
					value: false
				},
				message: {
					type: String,
					computed: 'computedMessage(loaded)'
				}
			},
			computedMessage: function(loaded){
				return (loaded)?"Loaded!":"Loading...";
			},
			ready: function(){
				var self = this;
				self.loaded = false;
				setTimeout(function(){
					self.loaded = true;
				}, 3000);
			}
		})
		
		Polymer({
			is: "object-data-binding",
			properties: {
				message: {
					type: Object,
					value: function(){
						return{
							text: "Object data binding",
							status: "Success!"
						}
					}
				}
			},
			ready: function(){
				//Does not work
				//this.message.text = "message changed";
				this.message = {text: "message changed", status: "status changed"};
				//Changing only one property
				//this.set("message.text", "message change");
			}
		})
		
		Polymer({
			is: "attribute-binding",
			properties: {
				messageClass: {
					type: String,
					value: "message-class"
				},
				messageStyle: {
					type: String,
					value: "message-style"
				},
				messageChecked: {
					type: Boolean,
					value: "true"
				},
				messageUrl: {
					type: String,
					value: "http://pluralsight.com"
				},
				messageLabel: {
					type: String,
					value: "message-label"
				}
			}
		})
		
		InputElement = Polymer({
			is: 'type-test',
            extends: 'input',
        });

		InputElement = Polymer({
			is: 'input-element',
            extends: 'input',
            created: function(){
              this.value = "hello there";
            },
            ready: function(){
            	console.log("Created: I am ready.");
            }
        });
		//var ipElement = new InputElement();
		//console.log(ipElement instanceof HTMLInputElement);
		//document.querySelector("body").appendChild(ipElement);
				
		classConstructorElem = Polymer.Class({
			is: "class-constructorElement",
			created : function() {
				this.textContent = "Class Constructor Element";
	              console.log("Created: The element has been created.");
	          },
	          ready: function() {
	              console.log("Ready: Property values set and local DOM is initialized.");
	              this.message = "hello2";
	          },
	          attached: function() {
	              console.log("Attached: The element is attached to the document." +
	                  "Can be called multiple times.");
	          },
	          detached: function() {
	              console.log("Detached: The element has been detached");
	          },
	          factoryImpl: function() {
	              console.log("Factory Impl: Only invoked when creating an event using" + 
	                  " the constructor.")
	          },
	          attributeChanged: function(attrName, oldVal, newVal) {
	              console.log("AttributeChanged: Attribute " + attrName + 
	                  " oldValue: " + oldVal + " newValue: " + newVal);
	          }
		})
		
		// Approach 2
		document.registerElement('class-constructorElement', classConstructorElem);
		
		// Approach 3
		var e1 = new classConstructorElem();
		document.querySelector("body").appendChild(e1);
		//Approach 4
		//var e2 = document.createElement("class-constructorElement");
		//document.querySelector("body").appendChild(e2);
	})
</script>